# iBlog 项目环境配置指南 (Ubuntu)

## 📋 系统要求
- Ubuntu 18.04 或更高版本
- 至少 2GB 可用内存
- 至少 10GB 可用磁盘空间

## 🗂️ 目录
1. [MySQL 安装与配置](#mysql-安装与配置)
2. [DBeaver 安装（可选）](#dbeaver-安装可选)
3. [Node.js 与 nvm 安装](#nodejs-与-nvm-安装)
4. [项目依赖安装](#项目依赖安装)
5. [数据库初始化](#数据库初始化)
6. [项目启动](#项目启动)

---

## MySQL 安装与配置

### 1. 安装 MySQL Server
```bash
# 更新包管理器
sudo apt update

# 安装 MySQL Server
sudo apt install mysql-server -y

# 启动 MySQL 服务
sudo systemctl start mysql
sudo systemctl enable mysql

# 检查服务状态
sudo systemctl status mysql
```

### 2. 安全配置 MySQL
```bash
# 运行安全脚本
sudo mysql_secure_installation
```
按照提示进行以下配置：
- 设置 root 密码
- 移除匿名用户
- 禁止 root 远程登录
- 移除测试数据库
- 重新加载权限表

### 3. 验证 MySQL 安装
```bash
# 登录 MySQL
sudo mysql -u root -p

# 在 MySQL 中查看版本
SELECT VERSION();
exit
```

---

## DBeaver 安装（可选）

可视化界面数据库管理

### 方法一：使用 Snap（推荐）
```bash
sudo snap install dbeaver-ce
```

### 方法二：使用官方包
```bash
# 下载 DBeaver
wget https://dbeaver.io/files/dbeaver-ce_latest_amd64.deb

# 安装
sudo dpkg -i dbeaver-ce_latest_amd64.deb
sudo apt-get install -f  # 修复依赖

# 启动 DBeaver
dbeaver-ce
```

---

## Node.js 与 nvm 安装

### 1. 安装 nvm（Node Version Manager）
```bash
# 下载并安装 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# 重新加载 bash 配置
source ~/.bashrc

# 验证 nvm 安装
nvm --version
```

### 2. 安装 Node.js
```bash
# 安装最新的 LTS 版本
nvm install --lts

# 使用 LTS 版本
nvm use --lts

# 设置为默认版本
nvm alias default node

# 验证安装
node --version
npm --version
```

---

## 项目依赖安装

### 1. 克隆项目（如果从 Git 获取）
```bash
git clone https://github.com/kiraTheresa/iblog-server
cd server-for-iblog
```

### 2. 安装项目依赖
```bash
# 使用 npm
npm install

# 或者使用 yarn
yarn install
```

### 3. 检查依赖安装
```bash
# 检查是否安装成功
npm list

# 如果有 TypeScript，检查编译
npx tsc --noEmit
```

---

## 数据库初始化

### 1. 创建数据库和用户
```bash
# 使用 root 用户执行初始化脚本
sudo mysql -u root -p < database/init.sql
```

### 2. 手动初始化（备用方法）
```bash
# 登录 MySQL
sudo mysql -u root -p

# 在 MySQL 中执行以下命令：
CREATE DATABASE iblog;
USE iblog;

-- 创建用户（注意：生产环境请使用更强密码）
CREATE USER 'Theresa'@'localhost' IDENTIFIED BY '123';
GRANT ALL PRIVILEGES ON iblog.* TO 'Theresa'@'localhost';
FLUSH PRIVILEGES;

-- 退出 MySQL
exit
```

### 3. 验证数据库连接
```bash
# 使用新创建的用户登录测试
mysql -u Theresa -p -D iblog

# 在 MySQL 中查看表
SHOW TABLES;
exit
```

---

## 项目启动

### 1. 环境配置
```bash
# 复制环境配置示例文件（如果有）
cp .env.example .env

# 编辑配置文件，设置数据库连接信息
nano .env
```

### 2. 启动开发服务器
```bash
# 开发模式
npm run dev

# 或者生产模式
npm start
```

### 3. 验证运行
打开浏览器访问：`http://localhost:3000`（端口可能不同，请查看项目文档）

---

## 🔧 故障排除

### MySQL 连接问题
```bash
# 检查 MySQL 服务状态
sudo systemctl status mysql

# 检查端口监听
sudo netstat -tlnp | grep 3306

# 检查 MySQL 错误日志
sudo tail -f /var/log/mysql/error.log
```

### Node.js 权限问题
```bash
# 如果遇到权限问题，修复 npm 全局安装权限
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
source ~/.bashrc
```

### 防火墙配置
```bash
# 如果使用防火墙，开放 MySQL 端口
sudo ufw allow 3306
sudo ufw allow 3000  # 应用端口
```

---

## 📝 验证清单

完成所有步骤后，请验证：

- [ ] MySQL 服务正常运行
- [ ] 数据库 `iblog` 创建成功
- [ ] 用户 `Theresa` 可以连接数据库
- [ ] Node.js 和 npm 正确安装
- [ ] 项目依赖安装无错误
- [ ] 应用可以正常启动
- [ ] 可以访问应用界面

---

## 💡 提示

1. **生产环境部署**：在生产环境中请使用更强的密码和适当的安全配置
2. **端口配置**：确保应用端口和数据库端口在防火墙中正确配置
3. **备份**：定期备份数据库重要数据
4. **监控**：设置适当的日志和监控机制

